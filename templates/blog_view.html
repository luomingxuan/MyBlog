{% extends 'base.html' %}
{% block content %}
<div class="panel-glass mb-3 text-center">
  {% if logo_url %}
  <img src="{{ logo_url }}" alt="logo" style="width:48px;height:48px;border-radius:50%;object-fit:cover;">
  {% endif %}
  <h1 class="mb-0 text-white emboss">{{ title }}</h1>
  <div class="mt-3 d-flex justify-content-center gap-2">
    {% if resume_exist %}
    <a class="btn btn-light" href="{{ url_for('blog_bp.blog_resume_download', slug=slug) }}">下载相关资料</a>
    {% endif %}
    {% if is_owner %}
    <a class="btn btn-outline-light" href="{{ url_for('blog_bp.blog_edit', slug=slug) }}">编辑</a>
    <form method="post" action="{{ url_for('blog_bp.blog_delete', slug=slug) }}" onsubmit="return confirm('确认删除该博客？');">
      <button class="btn btn-outline-light" type="submit">删除</button>
    </form>
    {% endif %}
  </div>
</div>
<div class="panel-glass big-text" style="white-space: pre-wrap;">{{ summary }}</div>
{% if resume_url %}
<div class="mt-3 panel-glass p-3">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <strong>相关资料预览</strong>
    <div class="d-flex align-items-center gap-2">
      <a class="btn btn-light btn-sm" href="{{ resume_url }}" target="_blank">在新窗口打开</a>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('blog_bp.blog_resume_download', slug=slug) }}">下载</a>
    </div>
  </div>
  {% if resume_ext == '.pdf' %}
  <iframe class="resume-frame" src="{{ resume_url }}"></iframe>
  {% elif resume_ext == '.docx' %}
  <div id="docx-preview" class="docx-panel"></div>
  <script src="https://cdn.jsdelivr.net/npm/mammoth/mammoth.browser.min.js"></script>
  <script>
    (function(){
      fetch('{{ resume_url }}')
        .then(function(r){ return r.arrayBuffer(); })
        .then(function(buf){
          return mammoth.convertToHtml({ arrayBuffer: buf });
        })
        .then(function(result){
          document.getElementById('docx-preview').innerHTML = result.value || '';
        })
        .catch(function(){
          document.getElementById('docx-preview').innerHTML = '<div class="text-muted">预览失败，请使用“在新窗口打开”或“下载”查看。</div>';
        });
    })();
  </script>
  {% elif resume_ext == '.doc' %}
  <iframe class="resume-frame" src="https://view.officeapps.live.com/op/view.aspx?src={{ abs_resume_url }}"></iframe>
  <div class="small text-muted mt-2">如预览无法加载，请使用“在新窗口打开”或“下载”查看。</div>
  {% endif %}
</div>
{% endif %}
{% endblock %}
